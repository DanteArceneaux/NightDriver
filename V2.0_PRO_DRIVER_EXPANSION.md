# Night Driver v2.0 - Pro Driver Expansion

## üöÄ Release Summary

This major update transforms Night Driver from a passive dashboard into a **proactive driver assistant** with intelligent routing, shift management, and hands-free guidance.

---

## ‚ú® New Features

### 1. **Data Trust & Integrity** ‚úÖ
- **Radius-based Event Search**: Single 50km radius query instead of multi-city for better accuracy
- **Robust Event Filtering**: Excludes VIP passes, parking passes, suite upgrades, canceled/postponed events
- **Driver Reporting System**: Report bad events via `/api/events/report` endpoint
- **Event Blacklist**: Server-side blacklist prevents reported events from reappearing

### 2. **Shift Mode & Personalization** ‚úÖ
- **Shift Tracking**: Start/end shifts with real-time duration and earnings tracking
- **Goal Selector**: Choose between:
  - **Balanced**: Good earnings + reasonable distance
  - **Max Earnings**: Highest score zones (may be far)
  - **Stay Close**: Minimize driving distance
- **Dynamic Scoring**: Algorithm adjusts weights based on active goal
- **Shift Summary**: Displays elapsed time and estimated earnings

### 3. **TomTom Routing Integration** ‚úÖ
- **Real Travel Time**: Accurate drive times accounting for traffic
- **Distance Calculation**: Actual road distance, not "as the crow flies"
- **Traffic-Aware**: Uses TomTom's live traffic data for ETA
- **API Endpoint**: `/api/route` for frontend route calculations
- **Fallback**: Haversine distance estimation when API unavailable

### 4. **Staging Spots** ‚úÖ
- **All 30 Zones**: Each zone now has a recommended safe parking/waiting location
- **Map Integration**: Staging spots shown in zone detail sheets
- **Navigation**: All navigation buttons (Google, Waze, Apple) route to staging spot
- **Strategic Positioning**: Spots chosen near high-demand areas with safe parking

### 5. **Move Now Intelligence** ‚úÖ
- **Smart Recommendations**: Algorithm detects when another zone offers 20%+ better efficiency
- **Goal-Aware**: Recommendations adapt to driver's selected goal
- **HUD Notification**: High-priority alert with target zone, distance, drive time
- **One-Tap Navigation**: Direct navigation button in alert

### 6. **Car Mode Layout** ‚úÖ
- **Ultra-Minimal UI**: High-contrast, black background, huge text
- **Oversized Touch Targets**: 6xl text, 8-10px icons, 3xl buttons
- **Top Pick Emphasis**: Massive display of #1 recommended zone
- **Quick Stats Bar**: Time, GPS status, hot zone count
- **Safety-First**: Designed for quick glances while driving

### 7. **4-Hour Move Plan** ‚úÖ
- **Timeline Visualization**: Step-by-step plan of where to be and when
- **Event-Driven**: Automatically positions driver for post-event surges
- **Earnings Projection**: Shows estimated $/hr for each step
- **Smart Sequencing**: Combines event endings with high-score zones
- **Pro Tips**: Contextual advice for maximizing earnings

### 8. **Voice Alerts** ‚úÖ
- **Web Speech API**: Browser-native text-to-speech
- **Priority System**: High/normal/low priority alerts
- **Predefined Messages**:
  - Surge alerts
  - Move recommendations
  - Event ending notifications
  - Shift start/end summaries
  - High demand zone entry
- **Toggle Control**: Enable/disable via settings
- **Hands-Free**: Perfect for driving

---

## üõ†Ô∏è Technical Implementation

### Backend Changes

#### New Services
- `backend/src/services/routing.service.ts`: TomTom routing integration
- `backend/src/services/eventBlacklist.service.ts`: Event reporting and blacklisting

#### Updated Services
- `backend/src/services/events.service.ts`:
  - Radius-based search (50km from Seattle metro center)
  - Status filtering (canceled/postponed)
  - Keyword junk removal (VIP, parking, suite passes)
  - Blacklist integration
- `backend/src/routes/api.routes.ts`:
  - `/api/events/report` endpoint
  - `/api/route` endpoint for routing calculations

#### Data Updates
- `backend/src/data/zones.ts`: Added `stagingSpot` coordinates to all 30 zones

### Frontend Changes

#### New Features
- `frontend/src/features/shift/`: Complete shift management system
  - `store.ts`: Zustand store for shift state
  - `types.ts`: TypeScript interfaces
- `frontend/src/components/Shift/`:
  - `GoalSelector.tsx`: UI for choosing driving goal
  - `ShiftControl.tsx`: Start/end shift controls with live stats
- `frontend/src/hooks/useMoveRecommendation.ts`: Move intelligence logic
- `frontend/src/components/MoveAlert/MoveNowAlert.tsx`: Move recommendation HUD
- `frontend/src/components/MovePlan/MovePlanTimeline.tsx`: 4-hour plan visualization
- `frontend/src/lib/voiceAlerts.ts`: Voice alert service
- `frontend/src/components/Settings/VoiceAlertsToggle.tsx`: Voice control toggle

#### New Layout
- `frontend/src/features/layout/CarModeLayout.tsx`: Ultra-minimal driving interface
- `frontend/src/features/theme/themes.ts`: Added "Car Mode" theme with high-contrast tokens

#### Updated Components
- `frontend/src/components/ZoneDetail/ZoneDetailSheet.tsx`: Shows staging spots
- `frontend/src/components/Header/Header.tsx`: Added "Car Mode" to theme selector
- `frontend/src/types/index.ts`: Added `stagingSpot` to `Zone` interface

---

## üìä API Endpoints

### New Endpoints

#### POST `/api/events/report`
Report a bad/wrong event for blacklisting.

**Request:**
```json
{
  "eventId": "string",
  "eventName": "string",
  "reason": "string (optional)"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Event reported and blacklisted",
  "blacklistedCount": 5
}
```

#### POST `/api/route`
Calculate route between two points with traffic.

**Request:**
```json
{
  "from": { "lat": 47.6062, "lng": -122.3321 },
  "to": { "lat": 47.4502, "lng": -122.3088 },
  "departAt": "2025-12-26T20:00:00Z (optional)"
}
```

**Response:**
```json
{
  "travelTimeMinutes": 25,
  "distanceMiles": 15.3,
  "trafficDelayMinutes": 5,
  "route": [
    { "lat": 47.6062, "lng": -122.3321 },
    { "lat": 47.5500, "lng": -122.3200 },
    { "lat": 47.4502, "lng": -122.3088 }
  ]
}
```

---

## üé® UI/UX Improvements

### Car Mode Theme
- **Background**: Pure black for OLED screens
- **Text**: White, 3xl-6xl font sizes
- **Buttons**: 3xl text, 8-10px icons, rounded-3xl
- **Borders**: 4px thick for high visibility
- **Colors**: Green for positive actions, red for high scores

### Move Now Alert
- **Position**: Fixed top-center, z-50
- **Animation**: Slide down with pulse effect
- **Priority**: Dismissible but persistent
- **Action**: One-tap navigation to target zone

### 4-Hour Move Plan
- **Timeline**: Vertical step-by-step layout
- **Connectors**: Visual lines between steps
- **Icons**: Clock, MapPin, TrendingUp for clarity
- **Earnings**: Prominent display of potential $/hr

---

## üîß Configuration

### Environment Variables
No new environment variables required. Uses existing TomTom API key for routing.

### Shift State Persistence
Shift data is persisted to `localStorage` under `night-driver-shift` key.

### Voice Alerts
Voice alert state is stored in memory (resets on page reload). Consider adding persistence if needed.

---

## üö¶ Usage Guide

### Starting a Shift
1. Select your driving goal (Balanced, Max Earnings, or Stay Close)
2. Click "Start Shift" button
3. Shift timer and earnings tracker begin

### Following Move Recommendations
1. When a better zone is detected (20%+ efficiency gain), a "Move Now" alert appears
2. Review target zone, distance, and drive time
3. Click "Navigate Now" to open navigation app
4. Dismiss alert if you choose to stay

### Using the 4-Hour Move Plan
1. View the timeline in the main dashboard
2. Follow the suggested sequence of zones
3. Plan shows when to move based on event endings
4. Estimated earnings displayed for each step

### Enabling Voice Alerts
1. Toggle "Voice Alerts" in settings
2. Grant browser microphone permissions if prompted
3. Receive spoken notifications for surges and moves

### Activating Car Mode
1. Select "Car Mode üöó" from theme dropdown
2. UI switches to ultra-minimal, high-contrast layout
3. Ideal for quick glances while driving

---

## üìà Performance

### API Rate Limits
- **TomTom Routing**: 2,500 requests/day (free tier)
- **Ticketmaster**: 5,000 requests/day (free tier)
- **Caching**: All responses cached for 5-10 minutes

### Browser Compatibility
- **Voice Alerts**: Chrome, Edge, Safari (requires Web Speech API)
- **Geolocation**: All modern browsers
- **WebSockets**: All modern browsers

---

## üêõ Known Issues

### Limitations
1. **TomTom Free Tier**: Limited to 2,500 route calculations/day
2. **Voice Alerts**: May not work in Firefox (limited Web Speech API support)
3. **Staging Spots**: Manually curated, may need adjustment based on driver feedback

### Future Improvements
1. **Machine Learning**: Learn from driver feedback to improve recommendations
2. **Historical Data**: Track actual earnings vs. predictions
3. **Multi-Driver Collaboration**: Share real-time demand data between drivers
4. **Weather Integration**: More granular weather-based scoring

---

## üéØ Next Steps

### Recommended Testing
1. Test shift mode with real driving sessions
2. Validate staging spot locations in each zone
3. Gather driver feedback on move recommendations
4. Monitor TomTom API usage to stay within free tier

### Potential Enhancements
1. **Offline Mode**: Cache routes and staging spots for offline use
2. **Driver Profiles**: Save preferred goals and zones per driver
3. **Earnings History**: Track actual earnings over time
4. **Social Features**: Driver leaderboards and tips sharing

---

## üìù Migration Notes

### Breaking Changes
- None. All changes are additive.

### Database Changes
- None. All data is in-memory or localStorage.

### API Changes
- Two new endpoints added (see API Endpoints section)
- All existing endpoints remain unchanged

---

## üôè Credits

- **TomTom**: Routing and traffic data
- **Ticketmaster**: Event data
- **Web Speech API**: Voice alerts
- **Zustand**: State management
- **Framer Motion**: Animations

---

## üìÑ License

Same as main project.

---

**Version**: 2.0.0  
**Release Date**: December 26, 2025  
**Codename**: Pro Driver Expansion

