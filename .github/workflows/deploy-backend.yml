name: Verify Backend Deployment (Render)

on:
  push:
    branches:
      - main # Or your backend branch, if different

jobs:
  verify-deployment:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Wait for Render Deployment
        # This action waits for a Render service to be deployed successfully.
        # It requires RENDER_API_KEY and RENDER_SERVICE_ID secrets.
        uses: anmol098/waka-readme-stats@master # Using a generic wait action, you might need a more specific one for Render
        env:
          API_KEY: ${{ secrets.RENDER_API_KEY }}
          SERVICE_ID: ${{ secrets.RENDER_SERVICE_ID }}
          # You would typically use Render's API to check deployment status
          # For simplicity, this is a placeholder. A real implementation would query Render API.
          # Example: curl -H "Authorization: Bearer $API_KEY" https://api.render.com/v1/services/$SERVICE_ID/deploys
          # And then parse the JSON to check status. A custom action or script would be ideal.
        run: |
          echo "Waiting for Render service ${{ secrets.RENDER_SERVICE_ID }} to deploy."
          # Placeholder for Render API call to check deployment status
          # You would need to implement actual Render API calls here or use a dedicated Render GitHub Action if available.
          # For now, we'll simulate a wait.
          sleep 60 # Wait for 60 seconds as a placeholder. Adjust as needed.

      - name: Get Backend Service URL
        id: get_url
        run: |
          BACKEND_URL="https://nightdriver.onrender.com"
          echo "BACKEND_URL=$BACKEND_URL" >> $GITHUB_OUTPUT

      - name: Verify Backend Health Check
        run: |
          echo "Checking backend health at ${{ steps.get_url.outputs.BACKEND_URL }}/api/health"
          curl -f -s ${{ steps.get_url.outputs.BACKEND_URL }}/api/health
          echo "âœ… Backend is healthy!"

      - name: Report Success
        run: echo "Render Backend deployment verified successfully!"

